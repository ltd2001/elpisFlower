<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手動選色 - Elpis Flower</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #222; color: #fff; padding: 20px; }
        .container { background: #333; padding: 20px; border-radius: 15px; max-width: 350px; margin: auto; }
        .warning { background: #ff0000; color: #eeff00; border: 1px solid #eeff00; padding: 10px; margin-bottom: 20px; border-radius: 5px; font-size: 0.9em; }
        .picker { margin: 15px 0; }
        input[type="color"] { width: 100px; height: 100px; border: none; background: none; cursor: pointer; }
        button { background: #4CAF50; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1.1em; cursor: pointer; transition: 0.3s; }
        button:hover { background: #45a049; }
        a { color: #aaa; text-decoration: none; display: block; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>手動調整顏色</h2>
        <div class="warning">⚠️ 提醒：檢查 RFID 已經被移除！<br>若偵測到新卡片，此設定將被覆蓋。</div>
        
        <div class="picker-section">
            <div class="picker">
                <div class="color-info">
                    <span>上方 (Upper)</span><br>
                    <span id="upperRGB">[0, 255, 255]</span>
                    <span id="upperHex" class="hex-val">#00FFFF</span>
                </div>
                <input type="color" id="upperPicker" value="#00ffff">

            </div>

            <div class="picker">
                <div class="color-info">
                    <span>下方 (Lower)</span><br>
                    <span id="lowerRGB">[0, 0, 255]</span>
                    <span id="lowerHex" class="hex-val">#0000FF</span>
                </div>
                <input type="color" id="lowerPicker" value="#0000ff">
            </div>
        </div>
        
        <button onclick="apply()">套用顏色</button>
        <a href="/">← 返回主頁</a>
    </div>

    <script>
        // 將 Hex 轉換為 RGB 數組
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return { r, g, b };
        }

        // 更新顯示文字
        function updateDisplay(type) {
            const picker = document.getElementById(type + 'Picker');
            const rgbLabel = document.getElementById(type + 'RGB');
            const hexLabel = document.getElementById(type + 'Hex');
            
            const hex = picker.value.toUpperCase();
            const rgb = hexToRgb(hex);
            
            rgbLabel.textContent = `[${rgb.r}, ${rgb.g}, ${rgb.b}]`;
            hexLabel.textContent = hex;
        }

        // 監聽 Picker 變動
        document.getElementById('upperPicker').addEventListener('input', () => updateDisplay('upper'));
        document.getElementById('lowerPicker').addEventListener('input', () => updateDisplay('lower'));

        // 初始化顯示
        updateDisplay('upper');
        updateDisplay('lower');

        // 套用按鈕
        function apply() {
            const lower = document.getElementById('upperPicker').value;
            const upper = document.getElementById('lowerPicker').value;
            const params = new URLSearchParams();
            params.append('lower', lower);
            params.append('upper', upper);

            fetch('/set_color', { method: 'POST', body: params })
            .then(res => { if(res.ok) alert('已立即更新顏色'); else alert('設定失敗'); });
        }
    </script>
</body>
</html>